// SPDX-License-Identifier: MIT

pragma solidity ^0.8.19;

import {Test, console} from "forge-std/Test.sol";
import {MoodNft} from "../../src/MoodNft.sol";
import {DeployMoodNft} from "../../script/DeployMoodNft.s.sol";

contract MoodNftIntegrationTest is Test {
    MoodNft moodNft;
    string public constant HAPPY_SVG_URI =
        "data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjAwIDIwMCIgd2lkdGg9IjQwMCIgaGVpZ2h0PSI0MDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIGZpbGw9InllbGxvdyIgcj0iNzgiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMyIgLz4KICAgIDxnIGNsYXNzPSJleWVzIj4KICAgICAgICA8Y2lyY2xlIGN4PSI2MSIgY3k9IjgyIiByPSIxMiIgLz4KICAgICAgICA8Y2lyY2xlIGN4PSIxMjciIGN5PSI4MiIgcj0iMTIiIC8+CiAgICA8L2c+CiAgICA8cGF0aCBkPSJtMTM2LjgxIDExNi41M2MuNjkgMjYuMTctNjQuMTEgNDItODEuNTItLjczIiBzdHlsZT0iZmlsbDpub25lOyBzdHJva2U6IGJsYWNrOyBzdHJva2Utd2lkdGg6IDM7IiAvPgo8L3N2Zz4=";
    string public constant SAD_SVG_URI =
        "data:application/json;base64,eyJuYW1lIjogIk1vb2QgTkZUIiwgImRlc2NyaXB0aW9uIjogIkFuIE5GVCB0aGF0IHJlZmxlY3RzIHRoZSBvd25lcnMgbW9vZC4iLCAiYXRyaWJ1dGVzIjogW3sidHJhaXRfdHlwZSI6ICJtb29kaW5lc3MiLCAidmFsdWUiOiAxMDB9XSwgImltYWdlIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1UQXlOSEI0SWlCb1pXbG5hSFE5SWpFd01qUndlQ0lnZG1sbGQwSnZlRDBpTUNBd0lERXdNalFnTVRBeU5DSWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklqNEtJQ0FnSUR4d1lYUm9JR1pwYkd3OUlpTXpNek1pQ2lBZ0lDQWdJQ0FnWkQwaVRUVXhNaUEyTkVNeU5qUXVOaUEyTkNBMk5DQXlOalF1TmlBMk5DQTFNVEp6TWpBd0xqWWdORFE0SURRME9DQTBORGdnTkRRNExUSXdNQzQySURRME9DMDBORGhUTnpVNUxqUWdOalFnTlRFeUlEWTBlbTB3SURneU1HTXRNakExTGpRZ01DMHpOekl0TVRZMkxqWXRNemN5TFRNM01uTXhOall1Tmkwek56SWdNemN5TFRNM01pQXpOeklnTVRZMkxqWWdNemN5SURNM01pMHhOall1TmlBek56SXRNemN5SURNM01ub2lJQzgrQ2lBZ0lDQThjR0YwYUNCbWFXeHNQU0lqUlRaRk5rVTJJZ29nSUNBZ0lDQWdJR1E5SWswMU1USWdNVFF3WXkweU1EVXVOQ0F3TFRNM01pQXhOall1Tmkwek56SWdNemN5Y3pFMk5pNDJJRE0zTWlBek56SWdNemN5SURNM01pMHhOall1TmlBek56SXRNemN5TFRFMk5pNDJMVE0zTWkwek56SXRNemN5ZWsweU9EZ2dOREl4WVRRNExqQXhJRFE0TGpBeElEQWdNQ0F4SURrMklEQWdORGd1TURFZ05EZ3VNREVnTUNBd0lERXRPVFlnTUhwdE16YzJJREkzTW1ndE5EZ3VNV010TkM0eUlEQXROeTQ0TFRNdU1pMDRMakV0Tnk0MFF6WXdOQ0EyTXpZdU1TQTFOakl1TlNBMU9UY2dOVEV5SURVNU4zTXRPVEl1TVNBek9TNHhMVGsxTGpnZ09EZ3VObU10TGpNZ05DNHlMVE11T1NBM0xqUXRPQzR4SURjdU5FZ3pOakJoT0NBNElEQWdNQ0F4TFRndE9DNDBZelF1TkMwNE5DNHpJRGMwTGpVdE1UVXhMallnTVRZd0xURTFNUzQyY3pFMU5TNDJJRFkzTGpNZ01UWXdJREUxTVM0MllUZ2dPQ0F3SURBZ01TMDRJRGd1TkhwdE1qUXRNakkwWVRRNExqQXhJRFE0TGpBeElEQWdNQ0F4SURBdE9UWWdORGd1TURFZ05EZ3VNREVnTUNBd0lERWdNQ0E1Tm5vaUlDOCtDaUFnSUNBOGNHRjBhQ0JtYVd4c1BTSWpNek16SWdvZ0lDQWdJQ0FnSUdROUlrMHlPRGdnTkRJeFlUUTRJRFE0SURBZ01TQXdJRGsySURBZ05EZ2dORGdnTUNBeElEQXRPVFlnTUhwdE1qSTBJREV4TW1NdE9EVXVOU0F3TFRFMU5TNDJJRFkzTGpNdE1UWXdJREUxTVM0MllUZ2dPQ0F3SURBZ01DQTRJRGd1TkdnME9DNHhZelF1TWlBd0lEY3VPQzB6TGpJZ09DNHhMVGN1TkNBekxqY3RORGt1TlNBME5TNHpMVGc0TGpZZ09UVXVPQzA0T0M0MmN6a3lJRE01TGpFZ09UVXVPQ0E0T0M0Mll5NHpJRFF1TWlBekxqa2dOeTQwSURndU1TQTNMalJJTmpZMFlUZ2dPQ0F3SURBZ01DQTRMVGd1TkVNMk5qY3VOaUEyTURBdU15QTFPVGN1TlNBMU16TWdOVEV5SURVek0zcHRNVEk0TFRFeE1tRTBPQ0EwT0NBd0lERWdNQ0E1TmlBd0lEUTRJRFE0SURBZ01TQXdMVGsySURCNklpQXZQZ284TDNOMlp6NEtDandoTFMwZ1pHRjBZVHBwYldGblpTOXpkbWNyZUcxc08ySmhjMlUyTkN4UVNFNHlXbmxDTTJGWFVqQmhSREJwVFZSQmVVNUlRalJKYVVKdldsZHNibUZJVVRsSmFrVjNUV3BTZDJWRFNXZGtiV3hzWkRCS2RtVkVNR2xOUTBGM1NVUkZkMDFxVVdkTlZFRjVDazVEU1dkbFJ6RnpZbTVOT1VsdGFEQmtTRUUyVEhrNU0yUXpZM1ZrZWsxMVlqTktia3g2U1hkTlJFRjJZek5hYmtscU5FdEpRMEZuU1VSNGQxbFlVbTlKUjFwd1lrZDNPVWxwVFhvS1RYcE5hVU5wUVdkSlEwRm5TVU5CWjFwRU1HbFVWRlY0VFdsQk1rNUZUWGxPYWxGMVRtbEJNazVEUVRKT1EwRjVUbXBSZFU1cFFUSk9RMEV4VFZSS2VrMXFRWGRNYWxsblRrUlJOQXBKUkZFd1QwTkJNRTVFWjJkT1JGRTBURlJKZDAxRE5ESkpSRkV3VDBNd01FNUVhRlJPZWxVMVRHcFJaMDVxVVdkT1ZFVjVTVVJaTUdWdE1IZEpSR2Q1VFVkTmRFMXFRVEZNYWxGbkNrMURNSHBPZWtsMFRWUlpNa3hxV1hSTmVtTjVURlJOTTAxdVRYaE9hbGwxVG1rd2VrNTZTV2ROZW1ONVRGUk5NMDFwUVhwT2VrbG5UVlJaTWt4cVdXZE5lbU41U1VSTk0wMXBNSGdLVG1wWmRVNXBRWHBPZWtsMFRYcGplVWxFVFROTmJtOXBTVU00SzBOcFFXZEpRMEU0WTBkR01HRkRRbTFoVjNoelVGTkphbEpVV2taT2ExVXlTV2R2WjBsRFFXZEpRMEZuU1VkUk9RcEphekF4VFZSSlowMVVVWGRaZVRCNVRVUlZkVTVEUVhkTVZFMHpUV2xCZUU1cVdYVk9hVEI2VG5wSlowMTZZM2xqZWtVeVRtazBNa2xFVFROTmFVRjZUbnBKWjAxNlkzbEpSRTB6Q2sxcE1IaE9hbGwxVG1sQmVrNTZTWFJOZW1ONVRGUkZNazVwTkRKTVZFMHpUV2t3ZWs1NlNYUk5lbU41Wldzd2VVOUVaMmRPUkVsNFdWUlJORXhxUVhoSlJGRTBUR3BCZUVsRVFXY0tUVU5CZUVsRWF6SkpSRUZuVGtSbmRVMUVSV2RPUkdkMVRVUkZaMDFEUVhkSlJFVjBUMVJaWjAxSWNIUk5lbU15U1VSSk0wMXRaM1JPUkdkMVRWZE5kRTVETkhsSlJFRjBUbmswTkFwTVZFMTFUV2t3TkV4cVJYUk9lVFF3VVhwWmQwNURRVEpOZWxsMVRWTkJNVTVxU1hWT1UwRXhUMVJqWjA1VVJYbEpSRlUxVGpOTmRFOVVTWFZOVTBGNlQxTTBlRXhVYXpGTWFtZG5DazlFWjNWT2JVMTBUR3BOWjA1RE5IbE1WRTExVDFOQk0weHFVWFJQUXpSNFNVUmpkVTVGWjNwT2FrSm9UME5CTkVsRVFXZE5RMEY0VEZSbmRFOUROREJaZWxGMVRrTXdORTVETkhvS1NVUmpNRXhxVlhSTlZGVjRUR3BaWjAxVVdYZE1WRVV4VFZNME1tTjZSVEZPVXpReVNVUlpNMHhxVFdkTlZGbDNTVVJGTVUxVE5ESlpWR2RuVDBOQmQwbEVRV2ROVXpBMFNVUm5kUXBPU0hCMFRXcFJkRTFxU1RCWlZGRTBUR3BCZUVsRVVUUk1ha0Y0U1VSQlowMURRWGhKUkVGMFQxUlpaMDVFWjNWTlJFVm5Ua1JuZFUxRVJXZE5RMEYzU1VSRlowMURRVFZPYm05cENrbERPQ3REYVVGblNVTkJPR05IUmpCaFEwSnRZVmQ0YzFCVFNXcE5lazE2U1dkdlowbERRV2RKUTBGblNVZFJPVWxyTUhsUFJHZG5Ua1JKZUZsVVVUUkpSRkUwU1VSQlowMVRRWGNLU1VSck1rbEVRV2RPUkdkblRrUm5aMDFEUVhoSlJFRjBUMVJaWjAxSWNIUk5ha2t3U1VSRmVFMXRUWFJQUkZWMVRsTkJkMHhVUlRGT1V6UXlTVVJaTTB4cVRYUk5WRmwzU1VSRk1RcE5VelF5V1ZSblowOURRWGRKUkVGblRVTkJORWxFWjNWT1IyY3dUME0wZUZsNlVYVk5hVUYzU1VSamRVOURNSHBNYWtsblQwTTBlRXhVWTNWT1EwRjZUR3BqZEU1RWEzVk9VMEV3Q2s1VE5IcE1WR2MwVEdwWlowOVVWWFZQUXpBMFQwTTBNbU42YTNsSlJFMDFUR3BGWjA5VVZYVlBRMEUwVDBNME1sbDVOSHBKUkZGMVRXbEJla3hxYTJkT2VUUXdTVVJuZFUxVFFUTUtUR3BTU1U1cVdUQlpWR2RuVDBOQmQwbEVRV2ROUTBFMFRGUm5kVTVGVFRKT2FtTjFUbWxCTWsxRVFYVk5lVUV4VDFSamRVNVRRVEZOZWsxblRsUkZlVWxFVlhwTk0zQjBUVlJKTkFwTVZFVjRUVzFGTUU5RFFUQlBRMEYzU1VSRlowMURRVFZPYVVGM1NVUlJORWxFVVRSSlJFRm5UVk5CZDB4VWF6SkpSRUkyU1dsQmRsQm5iemhNTTA0eVdubzBTME5xZDJoTVV6Qm5DbHBIUmpCWlZIQndZbGRHYmxwVE9YcGtiV055WlVjeGMwOHlTbWhqTWxVeVRrTjRVVkpFYXpCWmJHUXpXakpTZEZadWJHcE5iWGd5V1cxdmQyRlZNVlJPU0dSS1lWVktObHBGWkVjS1pGWndTRkp1VG1sTmFsWnpWVVpPUzJSWFNqVlRVemxSV2pJNE5GbDZUbUZpYTJ4SldraENZVk5HU25aVlJrNUtaVVV4UlZOVVFtcFRSMlJ3UTJ0c1NHRkhlR2hXTWxKMldrVlJkd3BoVlRGVlVWaHNUMU5GU1RCVFYyeERUVzFHV0ZacVRsSmlWR3N3VlVaT1NtUXdiRVZSVjJST1ZrVkdOVlJyVGtKbFJURkZVMVJDU21GVlNUQlpiR1EwWkZkT05rMUhiR2hUUmtsM0Nsa3dVblprYTNkNldrUk5TMXBJYXpGTk1ERTFUbGhhYW1KWFRqSlVWM0JDWkRBeFJFOVljR3RpVjA1d1ZVZGtkbG93YkVSUlYyUlJVMFZLYjFwRlpHNWFNWEIwWWtoT2FWSkVRbkFLVTFod1RtVnJNVFZUVlhSS1VUQkdibE5WVGtKYU1HeEVVVzEwVVZVd2NFOVViRkpHWlZGd1NsSkdhM2RWV0hCS1RXczFSRTVFU2twU1JtdDNVMVZTV2sxRmJFVlRWRXBQVVhwUmVRcFRWVkphVFVWc1JWWllhRTVpYXpFMVZGVlNRbVJWTlhCUlZFSlBVa2RrYmxSclVsSk9SV3hGVlZSQ1VGRXdSWGRVYTFKdVpFVXhjVkZZWkUxaGJHeHVRMnMxUlZWVVVrMVdSa1YzQ2xRd1drNU5NRFZWWVROV1QxRXdSWGxVYTA1Q1RWVXhWVk5YWkU5aGJFa3lXV3hTUWxvd09VVlRXR1JhWlZSQ05WUlZVbFprVlRWRVVWaGtUVlpGTUhwVVYydDNaVVUxY1ZkWVZrOEtZVlJDTmxSdWNFcGtSVEUyV1ROclMxa3pjRVpOYXpWd1RrUktUVlpGTUhwVVYyeENaV3MxTmxOWVVrNWxiVTQxVTFWU1RrMHdNWEJSV0doUFlXeHNNVlJ0YkVKbGF6VTJVMWRrVGdwbGJVNDFWRVpTUmsxck5YQk9SRXBLVWtVd2VsUlhhM2RsYXpVMlUxZGtUbVZ0VGpWYVYyeEtXbmR3VFdWcVVreFRWVTVDV2pCc1JXVklaRnBYUmtwMlUxVmtZV05IU2toa2VteEtDbUZWTlVkVWJYUldUV3hLVlZkWGJFUmhWVVp1VTFWT1Fsb3diRVJSVjJSaFVrUkNjRlpHVWxabFJURndVVmhvVDFKRlNuRlVSbEpLWkRBMVZFNUVRa3BTUlVZd1Eyc3hObGt6YkVvS1VrVlZlVlJ0YXpCTmEzaFZWRlJPVG1GVlJqWlVibkJMWldzeFZWZFVTazFoYkd4dVZGaHdhbVZWYkVWVVZFNU9ZVlZHTmxSdWNFcGFNREUyV1ROc1RWWkZWWGxVYldzd1RXdHNSUXBVVkU1T1lWUkNObFJ1Y0Vwa1JURlZWMVJKUzFSSGNGcGtSVEUyV1ROc1RWWkZNSHBVVjJ0M1pXczFObE5xV2xWV1JXc3dWREJPUWsxRk1YRlNiV2hQVWtka01WUlZVa1phTURWRkNsb3pWazVTUlZadVZGVk9RbVF3YkVWU1YyUlFWa1pzYmxSVlRrSk5SVGxFVGtoa1RsVXdSWGRVTUUwd1pIZHdUbFV3UmpOVFZWSkNXakF4VkUxRVZrOWhWVVl6V2xjd2QyVnJOVFlLVjFka1RtRnRUalZaVlUxM1RVVTVSRTVJYUZwbFZFRjNWRWR3U2xvd01VUk5SRTVOWVcxa01GUllhekJsVlhoVldqTldUbFY2UVhwVVIzQlRVa1UxY1ZGVVFrcFNSbXcyUTJzMWNBcE9TR2hLVWtaVmVWUlhhekJOVld4RlZsUldUMlZWUlhoVVZsSktXakExVldGNlRtcGxWRUV4VkZkck1HVkZiRVZVVkZaTllXdFdNRlF4VWxaa1ZUbEVVVlJTVUZGNlVYbFhXR3QzQ21SVk1UVlJWRUpOWVd0c01GUllhekJPVld4RldUTlZTMVJyVFhkT1JYaHhVbGRrVDJWVVVYZFZNRkpPVFdzeFNGSlVVa3BTUjJSdVZGVk9RbVF3YkVWU1dGSlFVWHBCTUZSSGNGTUtZV3MxUkU1RVFrMVdSMk4zVkVkd1Rsb3dOVFpWV0ZaUFZYcENORlJzVWtaa1ZUVndVVmhvVDJGclJqQlVWbEpXWlVGd1RXRnNjRFpVVmxKV1RWVjRjVmRYWkU5aGJVNHhWRmhzUWdwbFJUVnhVVmRrVGxaR1ZqUlVSM0JoWVVVNVJGRlVVa3BTUlVadVZGVk9RbVZGZUZWYU1tUlFVWHBSZDFwWE1IZGxWVFZFVFVoc1RtRnNTbTlVYTFKdVpGVXhSVkpYWkU5U1IyUXhDa05yTVVWU1YyUk9VVEJHTTFOVlVrWmFNREZFVFVSV1QyRlZSWGRVTUUwd1pEQXhWRkZVUWxCUmVsSXpWRlpPUW1Rd2JFVlJWMlJPVlRCR00xTlZVbkpOYlZad1UxZGtUV1ZxVWt3S1UxVk9RbG93YkVWbFNHUmFWMFpLZGxOVlpHRmpSMHBJWkhwclMxTlhiRTVsYXpFMlZGZHNSR0ZWUm01VFZVNUNXakJzUkZGWFpHRlNSRUp3VmtaU1NrNUZPVVJSVkVKT1lXdGFid3BVYTFKdVdqQTFSVm95WkU1Uk1FWTBVMVZTUWxvd09WVlhWMlJPVVRCRmQxUXdUa0pOUlRsRVVWaGtTbEpGVm01VVZVMTNUbEZ3VDJGVlJqTmFWekIzWlZVeGNWVlhaRTVXUlZZMUNsZFlhM2RPUlRWVVRrUkdTbEpGUmpCVVZsSldUVlY0Y1ZkWFpFOWhiVTR4VkZocmQyVkZOWEZSVjJST1ZrWldORlJIY0dGaFJUbEVVVlJTU2xKRlJtNVVWVTVDWkRCc1JWb3laRkFLVVhwUmQwTnRSa1ZWVkZKTllXdGFjVlJyVFRCbFZXeEZVVmRrVDJWVVVUQlVSbEpPWkZVeGNGRlVVazFoYTFZd1ZHNXJNRTFGYkVWVVdGWlBaVlJCZDFReFRUQk5WV3hGVlZSR1RRcGhhekV3VkRCU2JtUlZOWEJSVkZaUFZYcFJNRlJHVW01T1JYaHhWMjV2UzFReFVrcGFNREUyWVROV1RsVXdSVEZVYkUwd1RrVnNSVnA2VWsxaGJIQnhWRWR3VGxvd05VUk9TR3hLQ2xKRk1URlVNVTVDVFRCNGNWVlhaRkJSZWxJMFUxVlNhbVJWTlVaYWVrcFBZV3hLYjFRd1RrSk9SV3hGVVZka1RsRXdSak5UVlZKdVpFRndVRkY2VVhkVldIQmFUV3MxTlU1RVNrb0tVa1pzTTFSVlRUQmxhMnhGVmxSV1QyVlVVWGhUVlZKV1pXc3hOVkZVUms1V1JXeHVWR3hTVG1WdFZuUk5TR2hPWVcxa01GUldVa1psVm14VlZWUlNTbEpHUlRCVFZWSkNXakF4VkFwUldHUktVa2R6ZVVOcmJFVlJWMlJQVWtka2JsUnJVbTVhTURGRVVWaG9TbEpGUmpCVU1WSmFXakF4U1dJeWJFcFJlbWR5VVRKd00yUnRUWHBYYlRWUldqSTVURlZGVGtaa1JYaFVDbEZ0ZEZwWFJrcHZWREl4YzJSR2JGaGFSM2hOVFRBMGVWZHViREJPUjBwWVpIcGpTMWRYTVVkbGJIQlZWMVJDVFZFd1JqQlVSbEV3VUZOQmRFeFVORDBnTFMwKyJ9";

    DeployMoodNft deployer;

    address USER = makeAddr("user");

    function setUp() public {
        deployer = new DeployMoodNft();
        moodNft = deployer.run();
    }

    function testViewTokenURIIntegration() public {
        vm.prank(USER);
        moodNft.mintNft();
        console.log(moodNft.tokenURI(0));
    }

    function testFlipTokenToSad() public {
        vm.prank(USER);
        moodNft.mintNft();

        vm.prank(USER);
        moodNft.flipMood(0);

        assertEq(
            keccak256(abi.encodePacked(moodNft.tokenURI(0))),
            keccak256(abi.encodePacked(SAD_SVG_URI))
        );
    }
}
